# ğŸ”’ ä½¿ç”¨ç§æœ‰åº“

[ä½¿ç”¨ç§æœ‰åº“](https://kubernetes.io/zh/docs/tasks/configure-pod-container/pull-image-private-registry/)

---

## ğŸ”‘ åˆ›å»ºæˆæƒSecret

Kubernetes é›†ç¾¤ä½¿ç”¨ docker-registry ç±»å‹çš„ Secret æ¥é€šè¿‡å®¹å™¨ä»“åº“çš„èº«ä»½éªŒè¯ï¼Œè¿›è€Œæå–ç§æœ‰æ˜ åƒã€‚

```
kubectl create secret docker-registry regcred \
  --docker-server=<ä½ çš„é•œåƒä»“åº“æœåŠ¡å™¨> \
  --docker-username=<ä½ çš„ç”¨æˆ·å> \
  --docker-password=<ä½ çš„å¯†ç > \
  --docker-email=<ä½ çš„é‚®ç®±åœ°å€>
```

- <your-registry-server> æ˜¯ä½ çš„ç§æœ‰ Docker ä»“åº“å…¨é™å®šåŸŸåï¼ˆFQDNï¼‰ã€‚ DockerHub ä½¿ç”¨ https://index.docker.io/v1/ã€‚
- <your-name> æ˜¯ä½ çš„ Docker ç”¨æˆ·åã€‚
- <your-pword> æ˜¯ä½ çš„ Docker å¯†ç ã€‚
- <your-email> æ˜¯ä½ çš„ Docker é‚®ç®±ã€‚
è¿™æ ·ä½ å°±æˆåŠŸåœ°å°†é›†ç¾¤ä¸­çš„ Docker å‡­è¯è®¾ç½®ä¸ºåä¸º regcred çš„ Secretã€‚

---

## ğŸ” æ£€æŸ¥ Secret

è¦äº†è§£ä½ åˆ›å»ºçš„ regcred Secret çš„å†…å®¹ï¼Œå¯ä»¥ç”¨ YAML æ ¼å¼è¿›è¡ŒæŸ¥çœ‹ï¼š

``` shell
kubectl get secret regcred --output=yaml

apiVersion: v1
data:
  .dockerconfigjson: eyJodHRwczovL2luZGV4L ... J0QUl6RTIifX0=
kind: Secret
metadata:
  ...
  name: regcred
  ...
type: kubernetes.io/dockerconfigjson
```

> âš ï¸ .dockerconfigjson å­—æ®µçš„å€¼æ˜¯ Docker å‡­è¯çš„ base64 è¡¨ç¤ºã€‚

è¦äº†è§£ dockerconfigjson å­—æ®µä¸­çš„å†…å®¹ï¼Œè¯·å°† Secret æ•°æ®è½¬æ¢ä¸ºå¯è¯»æ ¼å¼ï¼š

kubectl get secret regcred --output="jsonpath={.data.\.dockerconfigjson}" | base64 --decode
è¾“å‡ºå’Œä¸‹é¢ç±»ä¼¼ï¼š

{"auths":{"yourprivateregistry.com":{"username":"janedoe","password":"xxxxxxxxxxx","email":"jdoe@example.com","auth":"c3R...zE2"}}}
è¦äº†è§£ auth å­—æ®µä¸­çš„å†…å®¹ï¼Œè¯·å°† base64 ç¼–ç è¿‡çš„æ•°æ®è½¬æ¢ä¸ºå¯è¯»æ ¼å¼ï¼š

echo "c3R...zE2" | base64 --decode
è¾“å‡ºç»“æœä¸­ï¼Œç”¨æˆ·åå’Œå¯†ç ç”¨ : é“¾æ¥ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š

janedoe:xxxxxxxxxxx
æ³¨æ„ï¼ŒSecret æ•°æ®åŒ…å«ä¸æœ¬åœ° ~/.docker/config.json æ–‡ä»¶ç±»ä¼¼çš„æˆæƒä»¤ç‰Œã€‚

è¿™æ ·ä½ å°±å·²ç»æˆåŠŸåœ°å°† Docker å‡­è¯è®¾ç½®ä¸ºé›†ç¾¤ä¸­çš„åä¸º regcred çš„ Secretã€‚

---

## ğŸ’¿ åˆ›å»ºä¸€ä¸ªä½¿ç”¨ä½ çš„ Secret çš„ Pod

ä¸‹é¢æ˜¯ä¸€ä¸ª Pod é…ç½®æ¸…å•ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹ä¸­ Pod éœ€è¦è®¿é—®ä½ çš„ Docker å‡­è¯ regcredï¼š

``` yaml
pods/private-reg-pod.yaml  Copy pods/private-reg-pod.yaml to clipboard
apiVersion: v1
kind: Pod
metadata:
  name: private-reg
spec:
  containers:
  - name: private-reg-container
    image: <your-private-image>
  imagePullSecrets:
  - name: regcred
```

---



